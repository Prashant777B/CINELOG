{% extends "base.html" %}
{% block content %}
<h2 class="mb-4 text-center">My Library</h2>

<div class="row g-4">
    {% if movies %}
        {% for m in movies %}
        <div class="col-md-4">
            <div class="card bg-dark text-white h-100 shadow">

                {% if m.poster_path %}
                    <img src="https://image.tmdb.org/t/p/w342{{ m.poster_path }}" class="card-img-top" alt="{{ m.title }}">
                {% endif %}

                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ m.title }}</h5>

                    {% if m.year %}
                        <p class="text-muted mb-1">{{ m.year }}</p>
                    {% endif %}

                    <span class="badge {% if m.status == 'watched' %}bg-success{% else %}bg-secondary{% endif %} mb-2">
                        {{ m.status }}
                    </span>

                    <!-- Toggle Watch Status -->
                    <form method="post" action="{{ url_for('routes.update_status', movie_id=m.id) }}">
                        {% if m.status == 'watchlist' %}
                        <button class="btn btn-outline-success btn-sm w-100 mb-2" type="submit">Mark as Watched</button>
                        {% else %}
                        <button class="btn btn-outline-warning btn-sm w-100 mb-2" type="submit">Move to Watchlist</button>
                        {% endif %}
                    </form>

                    <!-- Review Button -->
                    <a href="{{ url_for('routes.review', movie_id=m.id) }}"
                       class="btn btn-info btn-sm w-100 mt-auto">‚úç Write Review</a>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">No movies added yet. Try searching from
            <a href="{{ url_for('tmdb.search') }}">Search</a>.</p>
    {% endif %}
</div>
{% endblock %}
