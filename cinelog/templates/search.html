{% extends "base.html" %}
{% block content %}
<div class="text-center mb-4">
  <h2>Search Movies üé¨</h2>

  <form method="get" class="d-flex justify-content-center mb-3" action="{{ url_for('tmdb.search') }}">
    <input type="text" name="q" class="form-control w-50 me-2"
           value="{{ query }}" placeholder="Search movies..." />
    <button class="btn btn-primary" type="submit">Search</button>
  </form>

  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}
</div>

{% if results %}
<div class="row">
  {% for movie in results %}
  <div class="col-md-3 mb-4">
    <div class="card bg-dark text-white h-100 shadow-sm border-secondary">

      {% if movie.poster_path %}
      <img src="{{ tmdb_img_base }}{{ movie.poster_path }}" class="card-img-top">
      {% endif %}

      <div class="card-body d-flex flex-column">
        <h6 class="card-title">{{ movie.title }}</h6>
        {% if movie.release_date %}
        <p class="text-muted small">{{ movie.release_date[:4] }}</p>
        {% endif %}

        <p class="small text-light">
        ‚≠ê {{ movie.vote_average or "N/A" }}/10
        </p>

        <small class="text-muted overview-text">
            {{ movie.overview[:90] }}...
        </small>

        <form method="post" action="{{ url_for('tmdb.import_tmdb', movie_id=movie.id) }}"
              class="mt-auto">
          <button class="btn btn-sm btn-success w-100 mt-2">
            ‚ûï Add to Library
          </button>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% elif query %}
<p class="text-center text-muted">No results for "{{ query }}".</p>
{% endif %}

<p class="text-center text-muted mt-5 small">
  This product uses the TMDB API but is not endorsed or certified by TMDB.
</p>

<style>
.overview-text {
  display: block;
  max-height: 50px;
  overflow: hidden;
}
</style>

{% endblock %}
