{% extends "base.html" %}
{% block title %}{{ movie.title }} - CineLog{% endblock %}

{% block content %}
<div class="row">
  <div class="col-lg-4 mb-4">
    {% if movie.poster_path %}
      <img src="{{ tmdb_img_base }}/w500{{ movie.poster_path }}" 
           class="img-fluid rounded shadow" 
           alt="{{ movie.title }}">
    {% else %}
      <div class="bg-secondary rounded d-flex align-items-center justify-content-center" style="min-height: 600px;">
        <i class="bi bi-film" style="font-size: 5rem; opacity: 0.3;"></i>
      </div>
    {% endif %}
  </div>

  <div class="col-lg-8">
    <h1 class="display-5 fw-bold mb-3">{{ movie.title }}</h1>

    {% if movie.tagline %}
      <p class="lead text-muted fst-italic mb-4">"{{ movie.tagline }}"</p>
    {% endif %}

    <div class="row g-3 mb-4">
      {% if movie.release_date %}
      <div class="col-auto">
        <span class="badge bg-secondary">
          <i class="bi bi-calendar"></i> {{ movie.release_date[:4] }}
        </span>
      </div>
      {% endif %}

      {% if movie.runtime %}
      <div class="col-auto">
        <span class="badge bg-secondary">
          <i class="bi bi-clock"></i> {{ movie.runtime }} min
        </span>
      </div>
      {% endif %}

      {% if movie.vote_average %}
      <div class="col-auto">
        <span class="badge bg-warning">
          <i class="bi bi-star-fill"></i> {{ "%.1f"|format(movie.vote_average) }}/10
        </span>
      </div>
      {% endif %}

      {% if movie.vote_count %}
      <div class="col-auto">
        <span class="badge bg-secondary">
          <i class="bi bi-people"></i> {{ "{:,}".format(movie.vote_count) }} votes
        </span>
      </div>
      {% endif %}
    </div>

    {% if movie.genres %}
    <div class="mb-4">
      <h5 class="mb-2">Genres</h5>
      <div class="d-flex flex-wrap gap-2">
        {% for genre in movie.genres %}
          <span class="badge bg-primary">{{ genre.name }}</span>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% if movie.overview %}
    <div class="mb-4">
      <h5 class="mb-2">Overview</h5>
      <p class="text-muted">{{ movie.overview }}</p>
    </div>
    {% endif %}

    {% if movie.production_companies %}
    <div class="mb-4">
      <h5 class="mb-2">Production</h5>
      <p class="text-muted">
        {{ movie.production_companies | map(attribute='name') | join(', ') }}
      </p>
    </div>
    {% endif %}

    <div class="card p-4 mt-4">
      {% if existing %}
        <div class="alert alert-info mb-3">
          <i class="bi bi-check-circle"></i> This movie is already in your library
        </div>
        <div class="d-grid gap-2">
          <a href="{{ url_for('routes.movie_detail', movie_id=existing.id) }}" class="btn btn-primary">
            <i class="bi bi-eye"></i> View in Library
          </a>
          <a href="{{ url_for('routes.library') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Library
          </a>
        </div>
      {% else %}
        <h5 class="mb-3">Add to Your Library</h5>
        <form method="post" action="{{ url_for('tmdb.import_tmdb', tmdb_id=movie.id) }}">
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select name="status" class="form-select">
              <option value="watchlist">Watchlist</option>
              <option value="watching">Currently Watching</option>
              <option value="watched">Watched</option>
            </select>
          </div>
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-success btn-lg">
              <i class="bi bi-plus-circle"></i> Add to Library
            </button>
            <a href="{{ url_for('tmdb.search') }}" class="btn btn-outline-secondary">
              <i class="bi bi-arrow-left"></i> Back to Search
            </a>
          </div>
        </form>
      {% endif %}
    </div>
  </div>
</div>

{% if movie.backdrop_path %}
<style>
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(rgba(13, 17, 23, 0.85), rgba(13, 17, 23, 0.95)), 
                url('{{ tmdb_img_base }}/original{{ movie.backdrop_path }}');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    z-index: -1;
  }
</style>
{% endif %}
{% endblock %}
